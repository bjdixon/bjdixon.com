<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon.ico">

    <title>Installing let&#x27;s encrypt | bjdixon.com</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,500' rel='stylesheet' type='text/css'>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/blog.css" rel="stylesheet">
    <!--





    ＼(^‿^ )／ Let's dance!



            ƪ(‾.‾“)┐    ƪ(˘⌣˘)┐    ƪ(˘⌣˘)ʃ    ┌("‾.‾)ʃ





    -->
  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" href="/">Home</a>
          <a class="nav-link active" href="/pages/notes/">Notes</a>
          <a class="nav-link" href="/pages/about/">About</a>
        </nav>
      </div>
    </div>

    <div class="blog-header">
      <div class="container">
        <h1 class="blog-title">Notes about things</h1>
        <p class="lead blog-description">A collection of my notes. Provided as is with no warranty of any kind expressed or implied.</p>
      </div>
    </div>

    <div class="container">

      <div class="row">

        <div class="col-sm-12 blog-main">

            <div class="blog-post">
            <h2 class="blog-post-title">Installing let&#x27;s encrypt</h2>
            <p class="blog-post-meta">Sat, Aug 6, 2016 by <a href="https://github.com/bjdixon">bjdixon</a></p>
            <h3 id="requirements">Requirements</h3>
<p>You must own or control the registered domain name that you wish to use the certificate with.</p>
<p>Create an A Record that points your domain to the public IP address of your server. This is required because of how Let&#39;s Encrypt validates that you own the domain it is issuing a certificate for. For example, if you want to obtain a certificate for example.com, that domain must resolve to your server for the validation process to work.</p>
<h3 id="install-dependencies">Install dependencies</h3>
<p>Make sure that the git and bc packages are installed</p>
<pre><code>sudo apt-get -y install git bc
</code></pre><p>Clone the letsencrypt repository from GitHub to /opt/letsencrypt. The /opt/ directory is a standard location for software that&#39;s not installed from the distribution&#39;s official package repositories</p>
<pre><code>sudo git clone https://github.com/letsencrypt/letsencrypt /opt/letsencrypt
</code></pre><p>Change to the letsencrypt directory</p>
<pre><code>cd /opt/letsencrypt
</code></pre><h3 id="retrieve-initial-certificate">Retrieve Initial Certificate</h3>
<p>nginx is probably already running on port 80, and the Let&#39;s Encrypt client needs this port in order to verify ownership of your domain, stop nginx temporarily</p>
<pre><code>sudo systemctl stop nginx
</code></pre><p>Run letsencrypt with the Standalone plugin</p>
<pre><code>./letsencrypt-auto certonly --standalone
</code></pre><p>You&#39;ll be prompted to answer several questions, including your email address, agreement to a Terms of Service, and the domain name(s) for the certificate.</p>
<h3 id="configure-nginx-for-https">Configure Nginx for HTTPS</h3>
<p>You&#39;ll need to add some details to your Nginx configuration. Open /etc/nginx/sites-enabled/default for editing</p>
<pre><code>sudo nano /etc/nginx/sites-enabled/default
</code></pre><p>Replace its contents with the following</p>
<pre><code># HTTP - redirect all requests to HTTPS:
server {
    listen 80;
    listen [::]:80 default_server ipv6only=on;
    return 301 https://$host$request_uri;
}

# HTTPS - proxy requests on to local Node.js app:
server {
    listen 443;
    server_name your_domain_name;

    ssl on;
    # Use certificate and key provided by Let&#39;s Encrypt:
    ssl_certificate /etc/letsencrypt/live/your_domain_name/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your_domain_name/privkey.pem;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers &#39;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&#39;;

    # Pass requests for / to localhost:8080:
    location / {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-NginX-Proxy true;
        proxy_pass http://localhost:8080/;
        proxy_ssl_session_reuse off;
        proxy_set_header Host $http_host;
        proxy_cache_bypass $http_upgrade;
        proxy_redirect off;
    }
</code></pre><p>Exit the editor and save the file. Start Nginx again</p>
<pre><code>sudo systemctl start nginx
</code></pre><p>You can test your new certificate and Nginx configuration by visiting http://your_domain_name/ in your browser. You should be redirected to https://your_domain_name/, without any security errors, and see the default page served by your Node.js app.</p>
<p><strong><em>The certificate retrieval process has to be repeated every 90 days</em></strong></p>

            </div>

        </div>

      </div><!-- /.row -->

    </div><!-- /.container -->


    <footer class="blog-footer">
        <h4>Elsewhere</h4>
        <ul class="list-unstyled">
            <li><a href="https://github.com/bjdixon">GitHub</a></li>
            <li><a href="https://gist.github.com/bjdixon">Gists</a></li>
        </ul>
    </footer>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/ie10-viewport-bug-workaround.js"></script>
    <script>
    var _gaq = _gaq || [['_trackPageview']];
    _gaq.unshift(['_setAccount', 'UA-1050597-5']);
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.async = true;
        g.src = '//www.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g, s);
    })(document, 'script');
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-1050597-5', 'bjdixon.com');
      ga('send', 'pageview');

    </script>

    <!--



    See ya!  (^_^)／



    -->
  </body>
</html>

